{% extends "myapp/base.html" %}
{% load crispy_forms_tags %}

{% block content %}
<h2>Create Product</h2>

<form method="POST" enctype="multipart/form-data">
    {% csrf_token %}
    <button class="btn btn-outline-primary" type="submit" name="save">Save</button>
    <button class="btn btn-outline-primary" type="submit" name="generate">Generate</button>
    <button class="btn btn-outline-primary" type="submit" name="list">LIST</button>
    <button class="btn btn-outline-primary" type="reset" name="cancel">Cancel</button>
    <a href="{% url 'product_list'%}" name="list" class="btn btn-outline-primary text-secondary px-0">
      List
  </a>
  <br><br>
  <!-- {{ product_form|crispy }} -->

  <div class="row">
    <div class="col-md-6 mb-0">
      {{ product_form.name|as_crispy_field }}
    </div>
    <div class="col-md-6 mb-0">
      {{ product_form.sku|as_crispy_field }}
    </div>
  </div>

  <div class="row">

    <div class="col-md-6 mb-0">
        <label for="color">Select Color:</label>
        <select id="color" name="color" class="form-select" multiple aria-label="multiple select example">
            {% for color in colors %}
            <option value="{{ color.id }}">{{ color.name }}</option>
            {% endfor %}
        </select>
    </div>

    <div class="col-md-6 mb-0">
        <label for="color">Select Size:</label>
        <select id="size" name="size" class="form-select" multiple aria-label="multiple select example">
            {% for size in sizes %}
            <option value="{{ size.id }}">{{ size.name }}</option>
            {% endfor %}
        </select>
    </div>
</div>

<h6>Upload Image</h6>
    <input type="file" name="image">
    
    <h6>Quantity</h6>
    <input type="number" name="quantity" min="1" >
    
    <h6>Price</h6>
    <input type="number" name="price" step="0.01" >

      {{ product_form.description|as_crispy_field }}

    <!-- <button type="submit">Save Product</button> -->
</form>
<hr>
<!-- Search Form -->
<h3>Search Product Variations</h3>
<form method="POST">
  {% csrf_token %}
  <div class="row">
    <div class="col-md-4">
      <input type="text" name="search_name" value="{{ search_name }}" placeholder="Search by Product Name" class="form-control">
    </div>
    <div class="col-md-4">
      <input type="text" name="search_color" value="{{ search_color }}" placeholder="Search by Color" class="form-control">
    </div>
    <div class="col-md-4">
      <input type="text" name="search_size" value="{{ search_size }}" placeholder="Search by Size" class="form-control">
    </div>
  </div>
  <button class="btn btn-outline-primary" type="submit" name="generate">Search</button>
</form>

{% if variations %}
    <h3>Search Results</h3>
    <table class="table table-striped table-bordered">
      <thead class="font-weight-bold table-primary">
        <tr>
                <th>No</th>
                <th>Product Name</th>
                <th>Image</th>
                <th>SKU</th>
                <th>Qty</th>
                <th>Price</th>
                <th>Color</th>
                <th>Size</th>
        </tr>
      </thead>
      <tbody>
        {% for variation in variations %}
            <td>{{ forloop.counter }}</td>
            <td>{{ variation.product.name }}-{{ variation.color.name }}-{{ variation.size.name }}</td>
            <td>  {% if variation.image %}
                <img src="{{ variation.image.url}}" style="width: 50px; height: auto;" alt="Product Photo">
                {% else %}
                <span>No image</span>
                {% endif %}</td>

            <td>{{ variation.product.sku }}-{{ variation.color.name }}-{{ variation.size.name }}</td>
            <td>{{ variation.quantity }}</td>
            <td>{{ variation.price }}</td>
            <td>{{ variation.color.name }}</td>
            <td>{{ variation.size.name }}</td>
          </tr>
        {% endfor %}
      </tbody>
    </table>

    {% else %}
    <h5>Product Not Found!!</h5>
  {% endif %}

{% endblock %}
